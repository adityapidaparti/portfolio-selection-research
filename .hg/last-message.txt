Code works in 95% of scenarios, but fails occasionaly. Weird.